<!DOCTYPE html>
<html>
<head>
    <title>IP Address Test - BevyFinder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #fff;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .info-card h4 {
            margin: 0 0 10px 0;
            color: #fff;
        }
        
        .info-card p {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.3);
            border: 1px solid rgba(244, 67, 54, 0.5);
        }
        
        .status.info {
            background: rgba(33, 150, 243, 0.3);
            border: 1px solid rgba(33, 150, 243, 0.5);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .hidden {
            display: none;
        }
        
        .scenario {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .scenario h4 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        
        .scenario p {
            margin: 5px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê IP Address Compatibility Test</h1>
        <p>This page demonstrates how BevyFinder works from any IP address or location.</p>
        
        <!-- Current Location Info -->
        <div class="test-section">
            <h3>üìç Current Location Information</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>Your Current Location</h4>
                    <p><strong>Hostname:</strong> <span id="current-hostname">Loading...</span></p>
                    <p><strong>Protocol:</strong> <span id="current-protocol">Loading...</span></p>
                    <p><strong>Port:</strong> <span id="current-port">Loading...</span></p>
                    <p><strong>Full URL:</strong> <span id="current-url">Loading...</span></p>
                </div>
                <div class="info-card">
                    <h4>Network Type</h4>
                    <p><strong>Network:</strong> <span id="network-type">Loading...</span></p>
                    <p><strong>Local Network:</strong> <span id="is-local">Loading...</span></p>
                    <p><strong>Public Domain:</strong> <span id="is-public">Loading...</span></p>
                    <p><strong>API URL:</strong> <span id="detected-api">Loading...</span></p>
                </div>
            </div>
        </div>
        
        <!-- API Connection Test -->
        <div class="test-section">
            <h3>üîó API Connection Test</h3>
            <p>Testing connection to the best available API endpoint:</p>
            <button class="btn" onclick="testAPIConnection()">Test API Connection</button>
            <button class="btn" onclick="testAllEndpoints()">Test All Endpoints</button>
            <div id="api-status" class="status info hidden"></div>
        </div>
        
        <!-- Login Test -->
        <div class="test-section">
            <h3>üîê Login Test</h3>
            <p>Test login with your credentials from this location:</p>
            <button class="btn" onclick="testLogin()">Test Login</button>
            <button class="btn" onclick="testLogout()">Test Logout</button>
            <div id="login-status" class="status info hidden"></div>
        </div>
        
        <!-- Scenarios -->
        <div class="test-section">
            <h3>üìã Supported Scenarios</h3>
            
            <div class="scenario">
                <h4>üè† Local Development (localhost)</h4>
                <p><strong>URLs:</strong> http://localhost:8080, http://127.0.0.1:8080</p>
                <p><strong>API:</strong> http://localhost:3000/api</p>
                <p><strong>Use Case:</strong> Development on your computer</p>
            </div>
            
            <div class="scenario">
                <h4>üè° Local Network (192.168.x.x, 10.x.x.x, 172.x.x.x)</h4>
                <p><strong>URLs:</strong> http://192.168.4.36:8080, http://192.168.1.100:8080</p>
                <p><strong>API:</strong> http://192.168.4.36:3000/api (same host as frontend)</p>
                <p><strong>Use Case:</strong> Access from phone, tablet, other devices on your network</p>
            </div>
            
            <div class="scenario">
                <h4>üåê Public Domain (Production)</h4>
                <p><strong>URLs:</strong> https://bevyfinder.com, https://your-app.netlify.app</p>
                <p><strong>API:</strong> https://bevyfinder.com/api</p>
                <p><strong>Use Case:</strong> Public access from anywhere in the world</p>
            </div>
            
            <div class="scenario">
                <h4>üîÑ Fallback Detection</h4>
                <p><strong>URLs:</strong> Any other domain or IP</p>
                <p><strong>API:</strong> Same host as frontend with port 3000</p>
                <p><strong>Use Case:</strong> Custom domains, VPS, cloud hosting</p>
            </div>
        </div>
        
        <!-- Console Log -->
        <div class="test-section">
            <h3>üìã Connection Log</h3>
            <div id="console-log" class="log"></div>
        </div>
    </div>

    <script>
        // ===== EMBEDDED API CLIENT =====
        class BevyFinderAPI {
            constructor() {
                this.baseURL = this.initializeURL();
                console.log('üîó API initialized with URL:', this.baseURL);
                logToConsole('üîó API initialized with URL: ' + this.baseURL);
                
                // Test the connection and find the best working URL
                this.testAndOptimizeConnection();
            }
            
            initializeURL() {
                // Smart API URL detection based on current location
                const currentHost = window.location.hostname;
                const currentProtocol = window.location.protocol;
                const currentPort = window.location.port;
                
                console.log('üîç Current location:', `${currentProtocol}//${currentHost}:${currentPort}`);
                logToConsole('üîç Current location: ' + `${currentProtocol}//${currentHost}:${currentPort}`);
                
                // If we're on localhost or local network, use local API
                if (currentHost === 'localhost' || currentHost === '127.0.0.1' || 
                    currentHost.startsWith('192.168.') || currentHost.startsWith('10.') || 
                    currentHost.startsWith('172.')) {
                    
                    // Try to use the same host as the frontend
                    const localAPI = `${currentProtocol}//${currentHost}:3000/api`;
                    console.log('üè† Using local API:', localAPI);
                    logToConsole('üè† Using local API: ' + localAPI);
                    return localAPI;
                }
                
                // If we're on a public domain, use production API
                if (currentHost.includes('bevyfinder.com') || currentHost.includes('netlify.app') || 
                    currentHost.includes('vercel.app') || currentHost.includes('github.io')) {
                    
                    const productionAPI = 'https://bevyfinder.com/api';
                    console.log('üåê Using production API:', productionAPI);
                    logToConsole('üåê Using production API: ' + productionAPI);
                    return productionAPI;
                }
                
                // Fallback: try to detect if we're on the same network as the server
                const fallbackAPI = `${currentProtocol}//${currentHost}:3000/api`;
                console.log('üîÑ Using fallback API:', fallbackAPI);
                logToConsole('üîÑ Using fallback API: ' + fallbackAPI);
                return fallbackAPI;
            }
            
            async testAndOptimizeConnection() {
                console.log('üß™ Testing API connection...');
                logToConsole('üß™ Testing API connection...');
                
                // List of possible API URLs to test
                const possibleURLs = [
                    this.baseURL, // Current detected URL
                    'http://192.168.4.36:3000/api', // Your specific local network
                    'http://localhost:3000/api', // Local development
                    'https://bevyfinder.com/api', // Production
                    'http://127.0.0.1:3000/api', // Alternative local
                ];
                
                // Remove duplicates
                const uniqueURLs = [...new Set(possibleURLs)];
                
                for (const url of uniqueURLs) {
                    try {
                        console.log(`üîç Testing: ${url}`);
                        logToConsole(`üîç Testing: ${url}`);
                        const response = await fetch(`${url.replace('/api', '')}/health`, {
                            method: 'GET',
                            mode: 'cors',
                            headers: { 'Accept': 'application/json' }
                        });
                        
                        if (response.ok) {
                            console.log(`‚úÖ Found working API: ${url}`);
                            logToConsole(`‚úÖ Found working API: ${url}`);
                            this.baseURL = url;
                            return;
                        }
                    } catch (error) {
                        console.log(`‚ùå Failed: ${url} - ${error.message}`);
                        logToConsole(`‚ùå Failed: ${url} - ${error.message}`);
                    }
                }
                
                console.log('‚ö†Ô∏è No working API found, using fallback:', this.baseURL);
                logToConsole(`‚ö†Ô∏è No working API found, using fallback: ${this.baseURL}`);
            }
            
            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                
                const defaultOptions = {
                    mode: 'cors',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                };
                
                const finalOptions = { ...defaultOptions, ...options };
                
                if (options.body && typeof options.body === 'object') {
                    finalOptions.body = JSON.stringify(options.body);
                }
                
                console.log(`üåê API Request: ${options.method || 'GET'} ${url}`);
                logToConsole(`üåê API Request: ${options.method || 'GET'} ${url}`);
                
                try {
                    const response = await fetch(url, finalOptions);
                    const text = await response.text();
                    
                    console.log(`üì° API Response: ${response.status} ${response.statusText}`);
                    logToConsole(`üì° API Response: ${response.status} ${response.statusText}`);
                    
                    try {
                        const data = JSON.parse(text);
                        return { success: true, data, status: response.status };
                    } catch (e) {
                        console.error('‚ùå JSON Parse Error:', text);
                        logToConsole(`‚ùå JSON Parse Error: ${text}`);
                        return { success: false, error: 'Invalid JSON response', raw: text, status: response.status };
                    }
                } catch (error) {
                    console.error('‚ùå Network Error:', error.message);
                    logToConsole(`‚ùå Network Error: ${error.message}`);
                    return { success: false, error: error.message };
                }
            }
            
            async login(email, password, rememberMe = false) {
                return this.request('/auth/login', {
                    method: 'POST',
                    body: { email, password, rememberMe }
                });
            }
            
            async getProfile() {
                const token = localStorage.getItem('bevyfinder_token');
                if (!token) return { success: false, error: 'No token' };
                
                return this.request('/auth/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
            }
        }
        
        // ===== TEST FUNCTIONS =====
        let api;
        
        function logToConsole(message) {
            const logDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.classList.remove('hidden');
        }
        
        function updateLocationInfo() {
            const currentHost = window.location.hostname;
            const currentProtocol = window.location.protocol;
            const currentPort = window.location.port;
            const currentURL = window.location.href;
            
            document.getElementById('current-hostname').textContent = currentHost;
            document.getElementById('current-protocol').textContent = currentProtocol;
            document.getElementById('current-port').textContent = currentPort || '80/443';
            document.getElementById('current-url').textContent = currentURL;
            
            // Determine network type
            let networkType = 'Unknown';
            let isLocal = 'No';
            let isPublic = 'No';
            
            if (currentHost === 'localhost' || currentHost === '127.0.0.1') {
                networkType = 'Localhost';
                isLocal = 'Yes';
            } else if (currentHost.startsWith('192.168.') || currentHost.startsWith('10.') || currentHost.startsWith('172.')) {
                networkType = 'Local Network';
                isLocal = 'Yes';
            } else if (currentHost.includes('bevyfinder.com') || currentHost.includes('netlify.app') || 
                       currentHost.includes('vercel.app') || currentHost.includes('github.io')) {
                networkType = 'Public Domain';
                isPublic = 'Yes';
            } else {
                networkType = 'Custom Domain/IP';
            }
            
            document.getElementById('network-type').textContent = networkType;
            document.getElementById('is-local').textContent = isLocal;
            document.getElementById('is-public').textContent = isPublic;
            
            // Show detected API
            if (api) {
                document.getElementById('detected-api').textContent = api.baseURL;
            }
        }
        
        async function testAPIConnection() {
            if (!api) api = new BevyFinderAPI();
            
            logToConsole('üß™ Testing API connection...');
            
            try {
                const response = await fetch(`${api.baseURL.replace('/api', '')}/health`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: { 'Accept': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showStatus('api-status', `‚úÖ API Connected: ${data.message}`, 'success');
                    logToConsole('‚úÖ API connection successful');
                } else {
                    showStatus('api-status', `‚ùå API Connection Failed: ${response.status}`, 'error');
                    logToConsole(`‚ùå API connection failed: ${response.status}`);
                }
            } catch (error) {
                showStatus('api-status', `‚ùå API Connection Error: ${error.message}`, 'error');
                logToConsole(`‚ùå API connection error: ${error.message}`);
            }
        }
        
        async function testAllEndpoints() {
            logToConsole('üß™ Testing all possible API endpoints...');
            
            const endpoints = [
                'http://192.168.4.36:3000/api',
                'http://localhost:3000/api',
                'https://bevyfinder.com/api',
                'http://127.0.0.1:3000/api',
                `${window.location.protocol}//${window.location.hostname}:3000/api`
            ];
            
            for (const endpoint of endpoints) {
                try {
                    logToConsole(`üîç Testing: ${endpoint}`);
                    const response = await fetch(`${endpoint.replace('/api', '')}/health`, {
                        method: 'GET',
                        mode: 'cors',
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    if (response.ok) {
                        logToConsole(`‚úÖ Working: ${endpoint}`);
                    } else {
                        logToConsole(`‚ùå Failed: ${endpoint} (${response.status})`);
                    }
                } catch (error) {
                    logToConsole(`‚ùå Error: ${endpoint} - ${error.message}`);
                }
            }
        }
        
        async function testLogin() {
            if (!api) api = new BevyFinderAPI();
            
            logToConsole('üß™ Testing login...');
            const result = await api.login('test3@example.com', 'password123', true);
            
            if (result.success) {
                showStatus('login-status', `‚úÖ Login successful! Welcome, ${result.data.user.name}`, 'success');
                logToConsole('‚úÖ Login successful');
            } else {
                showStatus('login-status', `‚ùå Login failed: ${result.error}`, 'error');
                logToConsole(`‚ùå Login failed: ${result.error}`);
            }
        }
        
        async function testLogout() {
            logToConsole('üß™ Testing logout...');
            localStorage.removeItem('bevyfinder_token');
            localStorage.removeItem('bevyfinder_remember_me');
            localStorage.removeItem('bevyfinder_user_email');
            showStatus('login-status', '‚úÖ Logged out successfully', 'success');
            logToConsole('‚úÖ Logged out successfully');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            logToConsole('üöÄ IP test page loaded');
            updateLocationInfo();
            api = new BevyFinderAPI();
            
            // Update API URL after initialization
            setTimeout(() => {
                updateLocationInfo();
            }, 1000);
        });
    </script>
</body>
</html> 